# Система Компьютерного Зрения и Создания Объектов

## Обзор

Данный документ описывает две новые системы, добавленные в игру "Эволюционная Адаптация: Генетический Резонанс":

1. **Система Компьютерного Зрения** - позволяет ИИ анализировать визуальную информацию и принимать решения на её основе
2. **Система Создания Объектов** - позволяет игроку создавать ловушки, врагов, сундуки и другие игровые объекты

## Система Компьютерного Зрения

### Описание

Система компьютерного зрения (`ComputerVisionSystem`) предоставляет ИИ возможность "видеть" окружающий мир и принимать решения на основе визуальной информации. Это значительно упрощает обучение ИИ, так как теперь он может анализировать то, что видит, а не только абстрактные данные.

### Основные возможности

#### 1. Обнаружение объектов
- **Типы объектов**: игроки, враги, NPC, предметы, сундуки, ловушки, препятствия, маяки, оружие, снаряды, эффекты
- **Визуальные характеристики**: позиция, размер, цвет, расстояние, направление
- **Уровень угрозы**: автоматический расчет угрозы для каждого объекта

#### 2. Визуальная память
- **Запоминание объектов**: ИИ запоминает увиденные объекты
- **Временное хранение**: память сохраняется на определенное время
- **Важность объектов**: более важные объекты запоминаются дольше

#### 3. Распознавание паттернов
- **Пространственные паттерны**: комбинации объектов в пространстве
- **Временные паттерны**: последовательности событий во времени
- **Анализ поведения**: изучение повторяющихся ситуаций

#### 4. Принятие решений
- **Q-learning**: обучение на основе визуальной информации
- **Действия**: приближение, избегание, атака, защита, сбор, взаимодействие, бегство, исследование, игнорирование
- **Адаптация**: изменение поведения на основе результатов

### Архитектура

```python
class ComputerVisionSystem:
    def __init__(self, entity_id: str):
        self.visual_field = VisualField()      # Поле зрения
        self.visual_memory = {}                # Визуальная память
        self.visual_patterns = {}              # Обнаруженные паттерны
        self.visual_q_table = {}               # Q-таблица для обучения
```

### Конфигурация

Файл: `config/computer_vision_config.json`

```json
{
  "vision_parameters": {
    "vision_radius": 50.0,
    "max_detection_distance": 100.0,
    "memory_duration": 30.0
  },
  "ai_learning": {
    "learning_rate": 0.1,
    "exploration_rate": 0.2
  }
}
```

### Использование

#### Инициализация
```python
from core.computer_vision_system import ComputerVisionSystem

# Создание системы зрения для ИИ
vision_system = ComputerVisionSystem("AI_ENTITY_001")
```

#### Обновление поля зрения
```python
# Сбор объектов в мире
world_objects = [player, enemies, items, obstacles]

# Обновление зрения
player_position = (player.x, player.y, player.z)
vision_system.update_visual_field(player_position, world_objects, current_time)
```

#### Принятие решений
```python
# Получение визуального решения
action = vision_system.make_visual_decision(current_time)

# Обучение на результате
vision_system.learn_from_visual_decision(action, success=True, reward=1.0)
```

#### Анализ визуальной информации
```python
# Получение анализа
analysis = vision_system.get_visual_analysis()
print(f"Объектов видно: {analysis['detected_objects']}")
print(f"Уровень угрозы: {analysis['threat_level']}")
```

## Система Создания Объектов

### Описание

Система создания объектов (`ObjectCreationSystem`) позволяет игроку динамически создавать различные игровые объекты: ловушки, врагов, сундуки, предметы, препятствия и другие.

### Основные возможности

#### 1. Типы создаваемых объектов
- **Ловушки**: шипованные, взрывные, ядовитые
- **Враги**: гоблины, орки, скелеты
- **Сундуки**: деревянные, железные, магические
- **Предметы**: зелья здоровья, зелья маны
- **Препятствия**: камни, деревья

#### 2. Шаблоны объектов
- **Предустановленные шаблоны**: готовые конфигурации объектов
- **Кастомизация**: изменение характеристик при создании
- **Требования**: уровень навыков, материалы, золото

#### 3. Управление объектами
- **Создание**: создание объектов по шаблонам
- **Уничтожение**: удаление объектов из мира
- **Поиск**: поиск объектов по типу и области
- **Статистика**: отслеживание созданных объектов

#### 4. Ограничения
- **Лимиты**: максимальное количество объектов каждого типа
- **Ресурсы**: стоимость создания в золоте и материалах
- **Навыки**: требования к уровню навыков игрока

### Архитектура

```python
class ObjectCreationSystem:
    def __init__(self):
        self.templates = {}                    # Шаблоны объектов
        self.created_objects = {}              # Созданные объекты
        self.max_objects_per_type = {}         # Лимиты по типам
        self.creation_stats = {}               # Статистика создания
```

### Конфигурация

Файл: `config/object_creation_config.json`

```json
{
  "object_limits": {
    "trap": 50,
    "enemy": 100,
    "chest": 30
  },
  "creation_costs": {
    "trap_spike": {
      "gold": 10,
      "materials": {"iron": 2, "wood": 1}
    }
  }
}
```

### Использование

#### Инициализация
```python
from core.object_creation_system import ObjectCreationSystem, ObjectCreationRequest

# Создание системы
creation_system = ObjectCreationSystem()
```

#### Создание объекта
```python
# Создание запроса
request = ObjectCreationRequest(
    template_id="trap_spike",
    position=(100, 200, 0),
    creator_id="PLAYER_001"
)

# Создание объекта
created_object = creation_system.create_object(request, current_time)
```

#### Управление объектами
```python
# Получение объектов по типу
traps = creation_system.get_objects_by_type(ObjectType.TRAP)

# Поиск объектов в области
nearby_objects = creation_system.get_objects_in_area(
    center=(100, 200, 0), 
    radius=50.0
)

# Уничтожение объекта
creation_system.destroy_object("trap_000001")
```

#### Получение статистики
```python
stats = creation_system.get_creation_stats()
print(f"Всего создано: {stats['total_created']}")
print(f"Активных объектов: {stats['active_objects']}")
```

## Интеграция в игру

### Добавление в GameInterface

```python
# В __init__ метода GameInterface
from core.computer_vision_system import ComputerVisionSystem
from core.object_creation_system import ObjectCreationSystem

self.computer_vision = ComputerVisionSystem("PLAYER_VISION")
self.object_creation = ObjectCreationSystem()
```

### Обновление в игровом цикле

```python
# В методе _update
if hasattr(self, 'computer_vision') and self.player:
    # Сбор объектов мира
    world_objects = []
    world_objects.extend(self.entities)
    world_objects.extend(self.object_creation.created_objects.values())
    
    # Обновление зрения
    player_pos = (self.player.position.x, self.player.position.y, self.player.position.z)
    self.computer_vision.update_visual_field(player_pos, world_objects, time.time())
```

### Отрисовка созданных объектов

```python
# В методе _render_game
def _render_created_objects(self):
    for obj in self.object_creation.created_objects.values():
        if obj.is_active and obj.is_visible:
            color = obj.appearance.get('color', (128, 128, 128))
            size = obj.appearance.get('size', 10.0)
            
            self.isometric_renderer.render_entity(
                self.screen, obj.position, color, size=int(size)
            )
```

## Управление в игре

### Горячие клавиши

- **1** - Создать ловушку
- **2** - Создать геобарьер (препятствие)
- **3** - Создать сундук
- **4** - Создать врага

### Отображение информации

В игровом интерфейсе отображается:
- Количество созданных объектов
- Количество объектов, видимых ИИ
- Уровень угрозы в окружающей среде

## Преимущества новых систем

### Для ИИ
1. **Упрощение обучения**: ИИ теперь "видит" мир как игрок
2. **Лучшие решения**: основанные на визуальной информации
3. **Адаптивность**: обучение на реальных ситуациях
4. **Память**: запоминание важных объектов и событий

### Для игрока
1. **Динамический мир**: создание объектов по желанию
2. **Стратегия**: размещение ловушек и препятствий
3. **Тестирование**: создание врагов для тренировки
4. **Персонализация**: настройка игрового окружения

### Для разработки
1. **Модульность**: независимые системы
2. **Конфигурируемость**: настройка через JSON файлы
3. **Расширяемость**: легко добавлять новые типы объектов
4. **Отладка**: подробная статистика и логирование

## Технические детали

### Производительность
- **Оптимизация**: ограничения на количество объектов
- **Кэширование**: кэш визуальных данных
- **Очистка**: автоматическая очистка старых данных

### Совместимость
- **Интеграция**: работает с существующими системами
- **Обратная совместимость**: не нарушает существующий функционал
- **Модульность**: можно отключить без влияния на игру

### Безопасность
- **Валидация**: проверка входных данных
- **Ограничения**: лимиты на создание объектов
- **Изоляция**: изолированные системы

## Заключение

Добавление систем компьютерного зрения и создания объектов значительно расширяет возможности игры:

1. **ИИ становится умнее** - может видеть и анализировать мир
2. **Игрок получает больше контроля** - может создавать объекты
3. **Мир становится динамичнее** - постоянные изменения
4. **Игра становится интереснее** - новые механики и возможности

Эти системы создают основу для дальнейшего развития игры и добавления новых функций.
